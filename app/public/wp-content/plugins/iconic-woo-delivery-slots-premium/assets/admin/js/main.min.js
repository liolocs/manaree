function iconic_wds_admin_popup_init(){jQuery("#wds-admin-popup-wrap").length&&(window.iconic_wds_admin_popup=new Vue({el:"#wds-admin-popup-wrap",data:{showPopup:!1,hasAddress:!1,overrideRules:!1,shippingMethods:[],selectedShippingMethod:"",timeslotSetupEnable:"1"===iconic_wds_vars.settings.timesettings_timesettings_setup_enable,availableDates:[],availableTimeslots:{},formattedDestination:"",selectedDate:null,selectedSlot:"",selectedDateTimeslots:[],timeslotFocus:!1,address:{country:"",state:"",city:"",postcode:""}},components:{},mounted(){let e=jQuery("#wds-admin-popup-wrap").data("init");e.shipping_method&&(this.selectedShippingMethod=e.shipping_method,this.selectedDate=this.getDateFromYmd(e.ymd),this.overrideRules="true"===e.override_rules,this.overrideRules&&(this.selectedDateTimeslots=iconic_wds_vars.timeslot,this.selectedSlot=e.timeslot_id),Vue.nextTick(()=>{this.handleShippingMethodChange(e.ymd,e.timeslot_id)})),jQuery(document.body).on("iconic_wds_admin_popup_show",()=>{this.popup(!0),this.hasAddress&&this.fetchShippingMethods(this.selectedShippingMethod)}),jQuery(document).on("change","#_shipping_city, #_shipping_postcode, #_shipping_country, #_shipping_state",this.updateAddress),jQuery(document.body).on("iconic_wds_admin_popup_delete_timeslot",this.deleteTimeslot),this.updateAddress()},computed:{enabledDatesForDatepicker(){return this.overrideRules||0===this.availableDates.length?[]:this.availableDates.map(e=>{var t=e.ymd.slice(0,4),i=e.ymd.slice(4,6),e=e.ymd.slice(6,8);return{start:new Date(t+`/${i}/`+e),end:new Date(t+`/${i}/`+e)}})},disabledDates(){return!this.overrideRules&&!this.availableDates.length&&{weekdays:[1,2,3,4,5,6,7]}},datepickerAttributes(){let e=[];if(this.availableDates&&this.availableDates.length&&!this.overrideRules)e=this.availableDates.map(e=>{var t=e.ymd.slice(0,4),i=e.ymd.slice(4,6),e=e.ymd.slice(6,8),t=new Date(t+`/${i}/`+e);if(this.getDayFee(t))return t});else for(current=new Date((new Date).getTime()-2592e6),i=0;i<365;i++)current=new Date(current.getTime()+864e5),this.getDayFee(current)&&e.push(current);return[{key:"bookdable-dates",popover:{label:"date"},dates:e}]},formattedDate(){return this.selectedDate&&"function"==typeof this.selectedDate.format&&this.selectedDate.isValid()?this.formatDate(this.selectedDate):""},selectedSlotObj(){return this.selectedSlot&&this.selectedDateTimeslots?Object.values(this.selectedDateTimeslots).find(e=>this.selectedSlot===e.value):null},calculatedFee(){if(!this.selectedDate||!this.selectedDateTimeslots)return null;if(this.overrideRules)return t=i=0,i=this.getDayFee(this.selectedDate),this.selectedSlotObj&&this.selectedSlotObj.fee&&this.selectedSlotObj.fee.value&&(t=this.selectedSlotObj.fee.value),parseFloat(i)+parseFloat(t);let e=0;var t,i=this.getDayFee(this.selectedDate);if(null!==i&&(e+=i,this.timeslotSetupEnable&&this.selectedSlot))return(t=this.selectedDateTimeslots.find(e=>e.value===this.selectedSlot))&&t.fee&&t.fee.value&&(e+=parseFloat(t.fee.value)),e},selectedDateLabel(){if(!this.selectedDate)return"";let e=this.formatDate(this.selectedDate);var t=this.getDayFee(this.selectedDate);return e=t?e+" ("+accounting.formatMoney(t,iconic_wds_vars.currency)+")":e}},methods:{popup(e){this.showPopup=e},datePopover(e){let t;if(!this.overrideRules&&this.availableDates){var i=this.getYMD(e.date);for(e of this.availableDates)i===e.ymd&&(t=e.fee)}else t=this.getDayFee(e.date);if(t)return"+"+this.decodeHtml(accounting.formatMoney(t,iconic_wds_vars.currency))},handleShippingMethodChange(e,t){this.overrideRules||this.fetchDates(e,t)},handleOverrideChange(){this.selectedDateTimeslots=[],this.overrideRules?this.handleSelectDate():(this.selectedDate="",this.selectedDateTimeslots=[])},dateTimeBlur(){setTimeout(()=>{this.timeslotFocus=!1},100)},block(){jQuery(".wds-admin-popup-body").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock(){jQuery(".wds-admin-popup-body").unblock()},updateAddress(){this.address={city:jQuery("#_shipping_city").val(),postcode:jQuery("#_shipping_postcode").val(),country:jQuery("#_shipping_country").val(),state:jQuery("#_shipping_state").val()},this.address.city||this.address.postcode||this.address.country||this.address.state?this.hasAddress=!0:this.hasAddress=!1},fetchShippingMethods(t){var e={action:"iconic_wds_get_address_shipping_methods",calc_shipping_country:this.address.country,calc_shipping_state:this.address.state,calc_shipping_city:this.address.city,calc_shipping_postcode:this.address.postcode,nonce:window.iconic_wds_vars.ajax_nonce};let i=this;i.block(),jQuery.post(window.ajaxurl,e,function(e){e.success||!1!==i.overrideRules?(i.shippingMethods=e.data.shipping_methods,i.formattedDestination=e.data.formatted_destination,i.availableDates=[],i.availableTimeslots={},1===(e=Object.keys(i.shippingMethods)).length&&(i.selectedShippingMethod=e[0],Vue.nextTick(()=>{i.fetchDates()})),t&&(i.selectedShippingMethod=t,i.fetchDates())):alert(iconic_wds_vars.strings.no_shiping_methods)}).always(function(){i.unblock()})},fetchDates(i,s){var e={action:"iconic_wds_get_reservation_table_data",shipping_method:this.selectedShippingMethod,context:"admin",nonce:window.iconic_wds_vars.ajax_nonce};"string"==typeof i&&(e.ymd=i),this.overrideRules&&(e.skip_shipping_method_check="1");let o=this;o.block(),jQuery.post(window.ajaxurl,e,function(e){if(e.success&&(o.availableDates=e.data.dates,o.availableDates)&&0!==o.availableDates.length){for(var t in e.data.timeslots)o.$set(o.availableTimeslots,t,e.data.timeslots[t]);"string"==typeof i&&(o.selectedDate=o.getDateFromYmd(i),o.selectedDateTimeslots=o.availableTimeslots[i]),"string"==typeof s&&(o.selectedSlot=s)}}).always(function(){o.unblock()})},isDateAllowed(e){if(this.overrideRules)return!0;var t,i=this.getYMD(e);for(t of this.availableDates)if(i===t.ymd)return!0;return!1},getYMD(e){return e&&"function"==typeof e.getMonth?this.padDigits(e.getFullYear(),4)+this.padDigits(e.getMonth()+1,2)+this.padDigits(e.getDate(),2):""},padDigits(e,t){return Array(Math.max(t-String(e).length+1,0)).join(0)+e},handleSelectDate(e){this.overrideRules?(this.selectedDateTimeslots=Object.values(window.iconic_wds_vars.timeslot),this.selectedDate&&(this.selectedSlot=this.selectedDateTimeslots&&this.selectedDateTimeslots[0]?this.selectedDateTimeslots[0].value:null)):(e=this.getYMD(e),void 0!==this.availableTimeslots[e]||this.overrideRules||this.fetchDates(e),this.selectedDateTimeslots=this.availableTimeslots[e],this.selectedSlot=this.selectedDateTimeslots&&this.selectedDateTimeslots[0]?this.selectedDateTimeslots[0].value:""),window.setTimeout(()=>{this.timeslotFocus=!1})},saveSlot(){this.block();let t=this;var e={action:"iconic_wds_update_order_slot",order_id:woocommerce_admin_meta_boxes.post_id,security:iconic_wds_vars.ajax_nonce,date_ymd:this.getYMD(this.selectedDate),timeslot:this.selectedSlot,shipping_method:[this.selectedShippingMethod],override_rules:this.overrideRules,fee:this.calculatedFee,context:"admin"};jQuery.post(ajaxurl,e,function(e){e.success?(jQuery("#woocommerce-order-items").find(".inside").empty(),jQuery("#woocommerce-order-items").find(".inside").append(e.data.html),jQuery("#woocommerce-order-items").trigger("wc_order_items_reloaded"),t.unblock(),t.popup(!1)):window.alert(e.data.error),t.unblock()})},deleteTimeslot(){let t=this;var e={action:"iconic_wds_admin_delete_order_slot",order_id:woocommerce_admin_meta_boxes.post_id,security:woocommerce_admin_meta_boxes.order_item_nonce};jQuery.post(ajaxurl,e,function(e){e.success?(jQuery("#woocommerce-order-items").find(".inside").empty(),jQuery("#woocommerce-order-items").find(".inside").append(e.data.html),jQuery("#woocommerce-order-items").trigger("wc_order_items_reloaded"),t.unblock(),t.popup(!1)):window.alert(e.data.error),t.unblock()})},dateTimeEnabledForSM(e){var t;return!(!window.iconic_wds_vars.settings.general_setup_shipping_methods||!jQuery.isArray(window.iconic_wds_vars.settings.general_setup_shipping_methods))&&(t=window.iconic_wds_vars.settings.general_setup_shipping_methods.includes("any")||window.iconic_wds_vars.settings.general_setup_shipping_methods.includes(e),wp.hooks.applyFilters("iconic_wds_datetime_enabled_for_shipping_method",t,e))},getDateFromYmd(e){var t=e.slice(0,4),i=e.slice(4,6),e=e.slice(6,8);return new Date(t+`/${i}/`+e)},formatDate(e){if(e)return jQuery.datepicker.formatDate(iconic_wds_vars.settings.datesettings_datesettings_dateformat,e)},decodeHtml(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value},getDayFee(t){var e;return this.overrideRules?(e=window.iconic_wds_vars.settings.datesettings_fees_days[t.getDay()])?parseFloat(e):0:(e=this.availableDates.find(e=>e.ymd===this.getYMD(t)))?e.fee:null}}}))}!function(a){window.iconic_wds_admin={init(){a(document.body).trigger("iconic_wds_admin_popup_init"),a(document).on("click","#iconic_wds_add_timeslot_btn, .wds-edit-order-item",function(e){e.preventDefault(),a(document.body).trigger("iconic_wds_admin_popup_show")}),a(document).on("click",".wds-delete-order-item",function(e){e.preventDefault(),confirm(iconic_wds_vars.strings.delete_slot)&&a(document.body).trigger("iconic_wds_admin_popup_delete_timeslot")}),iconic_wds_admin.watch_for_override_checkbox(),iconic_wds_admin.display_shipping_method_ids(),iconic_wds_admin.toggle_notice_for_specific_date(),a("#group-timesettings-timesettings-timeslots").on("change","input[type=checkbox]",()=>setTimeout(iconic_wds_admin.toggle_notice_for_specific_date,100))},watch_for_override_checkbox(){a(".iconic_wds_days--override input").click(function(){var e=a(this).parent().data("override-target");a(e).each(function(){a(this).hasClass("iconic_wds_days--override")||a(this).toggle()})})},display_shipping_method_ids(){"woocommerce_page_wc-settings"===pagenow&&a.post(ajaxurl,{action:"iconic_wds_get_all_shipping_methods"}).done(function(e){var t,i,s,e=e.data;let o={};for(t in e)"any"!==t&&([i,s]=t.split(":"),void 0!==s)&&(o[s]=t);a(".wc-shipping-zone-method-rows").find("tr").each(function(){var e=a(this).data("id");void 0!==o[e]&&a(this).find(".wc-shipping-zone-method-title > a.wc-shipping-zone-method-settings").after('<div class="iconic-wds-shipping-zone-method-id"><small>'+o[e]+"</small></div>")})})},toggle_notice_for_specific_date(){a("#group-datesettings-datesettings-specific-days .wpsf-group__row").each(function(){var e=a(this).find(".wpsf-group__row-id").val(),t=a(this);!iconic_wds_admin.is_timeslot_enabled_for_specific_date(e)&&t.find(".datepicker").val()?(e=iconic_wds_vars.strings.select_timeslot_specific_date,iconic_wds_admin.show_specific_date_notice(t,e)):iconic_wds_admin.hide_specific_date_notice(t)})},show_specific_date_notice(e,t){var i=e.find(".iconic-wds-notice");i.length?i.show().text(t):e.find(".wpsf-group__field-wrapper--date").prepend('<div class="iconic-wds-notice iconic-wds-notice--specific-date">'+t+"</div>")},hide_specific_date_notice(e){e.find(".iconic-wds-notice").hide()},is_timeslot_enabled_for_specific_date(e){var t=a("#group-timesettings-timesettings-timeslots .wpsf-group__row");let i=!1;return t.each(function(){if(a(this).find('input[value="'+e+'"]').is(":checked"))return!(i=!0)}),i}},a(document).ready(iconic_wds_admin.init)}(jQuery),Vue.directive("click-outside",{bind(t,i,s){t.clickOutsideEvent=function(e){t===e.target||t.contains(e.target)||s.context[i.expression](e)},document.body.addEventListener("click",t.clickOutsideEvent)},unbind(e){document.body.removeEventListener("click",e.clickOutsideEvent)}}),Date.prototype.isValid=function(){return this.getTime()===this.getTime()},jQuery(document.body).on("iconic_wds_admin_popup_init",iconic_wds_admin_popup_init),function(i,e){var s={on_ready(){s.setup_checkbox_lists(),s.watch_checkbox_lists()},setup_checkbox_lists(){var e=i(".wpsf-list--checkboxes");e.length<=0||e.each(function(e,t){s.toggle_checkbox_lists(i(t).find('input[value="any"]'))})},watch_checkbox_lists(){i(e.body).on("change",'.wpsf-list--checkboxes input[value="any"]',function(){s.toggle_checkbox_lists(i(this))})},toggle_checkbox_lists(e){var t,i;e.length<=0||(t=e.closest(".wpsf-list--checkboxes"),i=e.prop("checked"),t.length<=0)||(i?(i=e.closest("li"),t.find("li").not(i).hide()):t.find("li").show())}};i(e).on("ready",s.on_ready)}(jQuery,document);